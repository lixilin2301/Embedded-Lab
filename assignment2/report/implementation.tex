\section{Implementation}
Obtaining the results from profiling we see that approximately 80\% of the time is spent on executing the \textit{gaussian\_smooth} function. Observing the code of this function we see that it is divided into two for loops (also seen in profiling).
First the blurring is done by convolution in the X-direction and then in the Y-direction by applying the gaussian kernel (one dimensional convolution matrix). This process is briefly shown in figure~\ref{fig:convolution}. There is a data dependency between the two convolution processes where one must be followed by the other, so simply performing one convolution in one direction on one processing unit and the other direction on a different processor will not work.

\begin{figure}
\centering
\includegraphics[width=0.4\textwidth]{drawings/gaussian_general}
\caption{Convolution process}
\label{fig:convolution}
\end{figure}

The most naive way of splitting the work between two processors and obtaining a speed-up is to compute the gaussian filtering on both processors for different parts of the image. The most simplistic way with a 50/50 load balancing is depicted in figure~\ref{fig:balancing} where the NEON is performing the convolutions on the top part of the image and the DSP performs the convolutions on the bottom part of the image. As shown in the workflow diagram in figure~\ref{fig:workflow} we then proceeded with the development of the gaussian filtering independently on each processor and later use clever techniques to split the computation between the two processors.

On the gpp side we define FRAC which is an integer value from zero to hundred that specifies the fraction of calculations that must be done on the NEON. After integration, both calculations were measured in time and a FRAC that resulted in an even balance between gpp and dsp was chosen. The two calculations have to be completed before the program can resume.

By load balancing we make sure that the synchronization happens as soon as possible and very little time is wasted on waiting for one of the processes to finish. Figure~\ref{fig:dataflow} shows the resulting dataflow of the current implementation. The subsequent sections go into more details of this process.

\begin{figure}
\centering
\includegraphics[width=0.4\textwidth]{drawings/gaussian_balancing}
\caption{Splitting the work}
\label{fig:balancing}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=0.4\textwidth]{drawings/model}
\caption{Data flow}
\label{fig:dataflow}
\end{figure}

\input{dsp}
\input{neon}
